def login = tasks.register('login', Exec) {
    def providers = project.getProviders()
    def username = providers.gradleProperty('username')
    def password = providers.gradleProperty('password')

    inputs.property("username", username)
    inputs.property("password", password)
    
    doFirst {
        standardInput = new ByteArrayInputStream("${username.get()}\n${password.get()}".getBytes())
    }

    commandLine = ['sh', 'login.sh']
}

tasks.register('doAuthenticated') {
    dependsOn(login)
    doLast {
        logger.lifecycle('Doing authenticated task')
    }
}
